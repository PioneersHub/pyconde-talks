{% extends "base.html" %}
{% load i18n %}
{% load svg_tags %}
{% block title %}
  {% translate "Sign In" %}
{% endblock title %}
{% block meta_description %}
  {% translate "Request a login code to access your account without a password" %}
{% endblock meta_description %}
{% block content %}
  <div class="max-w-md mx-auto p-4 animate-fade-in">
    <div class="card">
      <h1 class="text-2xl font-bold text-center mb-2">{% translate "Sign in with Email" %}</h1>
      <p class="text-muted text-center mb-6">{% translate "We'll send a secure login code to your email" %}</p>
      {% if form.non_field_errors %}
        <div class="alert-error mb-4 flex items-start gap-2" role="alert">
          {% svg 'envelope' "flex-shrink-0 mt-0.5" %}
          <span>{{ form.non_field_errors }}</span>
        </div>
      {% endif %}
      <form method="post" action="{% url 'account_request_login_code' %}">
        {% csrf_token %}
        {% if events %}
          <div class="mb-4">
            <label for="id_event" class="text-sm font-medium text-label mb-1 block">{% translate "Event" %}</label>
            <select name="event"
                    id="id_event"
                    class="w-full py-2 px-3 border border-weak rounded-md focus-ring-primary outline-none">
              {% for event in events %}
                <option value="{{ event.slug }}"
                        {% if event.slug == default_event_slug %}selected{% endif %}>{{ event.name }}</option>
              {% endfor %}
            </select>
            <p class="mt-1 text-xs text-subtle">{% translate "Select the event you purchased a ticket for" %}</p>
          </div>
        {% endif %}
        <div class="mb-6">
          <div class="flex justify-between items-center mb-1">
            <label for="{{ form.email.id_for_label }}"
                   class="text-sm font-medium text-label">{% translate "Email Address" %}</label>
            <span class="text-xs text-brand-blue">{% translate "Use your ticket email" %}</span>
          </div>
          {% if form.email.errors %}
            <div class="text-sm text-brand-red mb-2 flex items-center gap-1">
              {% svg 'exclamation-circle' %}
              {{ form.email.errors }}
            </div>
          {% endif %}
          <!-- Email input with icon -->
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              {% svg 'envelope' "h-5 w-5 text-subtle" %}
            </div>
            <input type="email"
                   name="email"
                   id="{{ form.email.id_for_label }}"
                   placeholder="{% translate "your@email.com" %}"
                   required
                   class="w-full pl-10 py-2 border border-weak rounded-md focus-ring-primary outline-none"
                   {% if form.email.value %}value="{{ form.email.value }}"{% endif %}>
          </div>
          <p class="mt-1 text-xs text-subtle">
            {% translate "Check your inbox (and spam folder) for a login code after submission" %}
          </p>
        </div>
        <button type="submit" class="w-full btn-primary">{% translate "Send Login Code" %}</button>
      </form>
    </div>
    <!-- Ticket instructions section -->
    <div class="mt-4 p-4 bg-subtle rounded-lg border border-weak">
      <h2 class="font-medium text-strong mb-2">{% translate "Important Note" %}</h2>
      <div class="text-sm text-muted space-y-2">
        <p>{% translate "Please use the same email address that you used when purchasing your ticket." %}</p>
        <div class="flex items-start gap-2 mt-2">
          {% svg 'check-circle' "text-brand-blue mt-0.5" %}
          <p>{% translate "Your login code will be valid for" %} {{ login_code_timeout_minutes }} {% translate "minutes." %}</p>
        </div>
        <div class="flex items-start gap-2 mt-2">
          {% svg 'exclamation-circle' "text-brand-blue mt-0.5" %}
          <p>{% translate "If you don't see the login code in your inbox, please check your spam or junk folder." %}</p>
        </div>
      </div>
    </div>
    <!-- How it works section -->
    <div class="mt-4 p-4 bg-subtle rounded-lg border border-weak">
      <h2 class="font-medium text-strong mb-2">{% translate "How it works" %}</h2>
      <ol class="list-decimal pl-5 text-sm text-muted space-y-1">
        <li>{% translate "Enter your ticket purchase email address" %}</li>
        <li>{% translate "We'll send you a secure login code" %}</li>
        <li>{% translate "Enter the code on the next screen to sign in" %}</li>
      </ol>
    </div>
  </div>
{% endblock content %}
